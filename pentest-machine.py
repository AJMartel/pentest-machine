#!/usr/bin/python

from libnmap.parser import NmapParser
import argparse
import subprocess

def parse_args():
	#Create the arguments
    parser = argparse.ArgumentParser()
    parser.add_argument("-f", "--nmapfile", help="Nmap XML file to parse")
    return parser.parse_args()

def main(args):
    report = NmapParser.parse_fromfile(args.nmapfile)
    for host in report.hosts:
        if host.is_up():
            print 'host: {0} {1}'.format(host.address, host.hostnames)

        # Get services
        for s in host.services:
            print '  service: {0}/{1} {2} {3} {4}'.format(s.port, s.protocol, s.state, s.service, s.banner)
            if s.service == 'http':
                nikto = subprocess.Popen(['/usr/bin/nikto', '-h', '{0}:{1}'.format(host.address, s.port)], stdout=subprocess.PIPE)
                print 'ran nikto'
                #out = nikto.communicate()
                #for line in out:
                #    # sometimes its None
                #    if line:
                #        print 'line', line



if __name__ == "__main__":
    main(parse_args())
